==========================================================================
              XSP 複合スプライト形状データコンバータ CVOBJ.X
                        ver 1.03     by よっしん
==========================================================================




==========================================================================
                                  説明
==========================================================================

本ツールは、スプライト管理システム XSP (ver2.00 以降)で使用する複合スプラ
イトの形状データを作成するための、データコンバータです。

形状データソースファイル（テキスト形式）を元に、リファレンスデータ（*.ref
）、フレームデータ（*.frm）、PCG データ（*.xsp）を生成します。その際、なる
べく PCG データサイズを小さく、使用スプライト数を少なくするような最適化を
施します。最適化の内容は以下の通りです。

  1) 空白 PCG の削除、及びそれを参照するスプライトの削除
  2) 同一の PCG（反転させることで一致するものも含む）の統合
  3) 他のスプライトに隠されて表示されないスプライトの削除

なお、生成されるリファレンスデータの構造体メンバー 'ptr' には、ファイル先
頭からのオフセットが格納されます。ランタイムで使用する際には 'ptr' が実際
のフレームデータアドレスをポイントするように、ユーザーの手でパッチする必要
があります。

本ツールはデータコンバータであり、それ以上の機能は持ちませんし、今後拡張さ
れる予定もありません。例えば、形状データをグラフィカルなユーザーインター
フェースで編集できるような機能や、何らかのシミュレーションにより生成するよ
うな機能は、本ツール以外の外部ツールでサポートされることを想定しています。
本ツールは、様々な外部ツールのデータコンバート部分を請け負うバックエンドを
担当する想定です。

形状データソースファイルは、将来にわかって互換性があります。XSP 側のバー
ジョンアップにより、形状データフォーマットに変更がある場合も、本ツールで吸
収されます。




==========================================================================
                              使用方法
==========================================================================

    CVOBJ [switch] [形状データソースファイル]

のように実行すると、形状データソースファイルを変換＆最適化し、リファレンス
データ、フレームデータ、PCG データ（それぞれ、形状データソースファイルの拡
張子を、.ref .frm .xsp に置き換えたもの）を生成します。

利用可能なスイッチは以下のとおりです。

  -A : 各種ファイルの生成時に、すでに同一名ファイルが存在していても強制的
       に上書きします。（このスイッチが指定されていない場合は、上書きする
       かどうかをユーザーに確認します。）


  -D : 実行過程を詳しく表示します。


  -N : PCG の最適化を実行しません。PCG データ（*.xsp）は生成されません。


  -O : 他のスプライトの隠されて表示されないスプライトを削除する最適化を実
       行します。若干処理時間がかかります。また、可視判定処理のためグラ
       フィックス面の RAM 領域を使用します。




==========================================================================
                   形状データソースファイルの記述方法
==========================================================================

形状データソースファイルは、上から順に読み取られます。
半角文字 '*' は、それ以降がコメントであることを示します。数値は 10 進数と
16 進数が使用出来ます。16 進数は '0x' 又は '$' で始めて下さい。数値の先頭
に '-' を付けると負の数値と見なされます。計算式は使用出来ません。スペース
は半角スペース若しくは TAB を使用して下さい。スペースは連続して記述するこ
とも省略することも出来ます。

形状データソースファイルの記述法については、実例サンプルの sample.src をご
参照下さい（文章で説明するより実物を見る方が分かりやすいと思います）。コメ
ントもたくさん添えておいたので、参考にして下さい。

形状データソースファイル記述で使用する書式と機能の詳細は以下に説明します。



--------------------------------------------------------------------------

● PCG データファイルの指定

書式：PCG_FILE = fname n

引数：fname = PCG データファイル名
      n = 読み込み PCG 数

機能：形状データソースファイルで使用する PCG データを指定します。必ず指定
      して下さい。PCG データのフォーマットは、XSP で使用する物と同じベタ形
      式です（フォーマットについて、詳しくは XSP のドキュメントを参照して
      下さい）。

      また、本式を連続して記述することで複数の PCG データファイルを読み込
      むことが出来ます。

      （例）
        PCG_FILE = PAGE0.SP $100
        PCG_FILE = PAGE1.SP $100

      この例では、PAGE0.SP をパターンナンバー 0〜$FF と見なして読み込み、
      PAGE1.SPをパターンナンバー $100〜$1FF と見なして読み込みます。

      スプライトパターンデータは最大 2048 パターンまで読み込めます。



--------------------------------------------------------------------------

● 複合スプライトのパターンナンバーの指定

書式：OBJ_NO = n

引数：n = 複合スプライトのパターンナンバー

機能：複合スプライトのパターンナンバーを指定します。なお 'OBJ_NO = NEXT'
      と記述すると、前回指定したナンバーの次のナンバーと見なされます。



--------------------------------------------------------------------------

● 複合スプライトを構成するスプライトの配置等の指定

書式：x y pt rv

引数：x  = X 座標
      y  = Y 座標
      pt = PCG パターンナンバー
      rv = 反転コード（$0000：反転無し）
                     （$4000：左右反転）
                     （$8000：上下反転）
                     （$C000：上下左右反転）

機能：複合スプライトを構成するスプライトの座標、PCG パターンナンバー、
      反転コードを指定します。



--------------------------------------------------------------------------

● 座標オフセットの指定

書式：XY_OFFSET = x y

引数：x = X 座標のオフセット
      y = Y 座標のオフセット

機能：この記述以降の複合スプライトを構成するスプライトの座標を、指定した
      オフセット分ずらします。

      オフセットの指定及び変更は、形状データソース中どこでも常時可能です。
      同一の複合スプライト内で複数回変更することも可能です。



--------------------------------------------------------------------------

● PCG パターンナンバーオフセットの指定

書式：PT_OFFSET = pt

引数：pt = PCG パターンナンバーのオフセット

機能：この記述以降の複合スプライトを構成する PCG のパターンナンバーを、
      指定したオフセット分ずらします。

      オフセットの指定及び変更は、形状データソース中どこでも常時可能です。
      同一の複合スプライト内で複数回変更することも可能です。



--------------------------------------------------------------------------

●　複合スプライト全体の反転コードの指定

書式：OBJ_RV = rv

引数：rv = 反転コード（$0000：反転無し）
                     （$4000：左右反転）
                     （$8000：上下反転）
                     （$C000：上下左右反転）

機能：この記述以降の複合スプライトを、指定したように反転します。

      反転コードの指定及び変更は、形状データソース中どこでも常時可能です。
      同一の複合スプライト内で複数回変更することも可能です。




==========================================================================
                                変更履歴
==========================================================================
◎：バグ及び不具合いの修正に関するもの。
●：改良点及び変更点その他に関するもの。

ver. 0.51 : (1996/2)

  ● とりあえず公開版。


ver. 1.00 : (1996/8)

  ● XSP バージョン 2.00 以降対応版。形状データのフォーマット自体が
     変更されているので、XSP バージョン 1.xx には非対応である。


ver. 1.01 : (1996/11)

  ◎ PCG ファイル指定時に、256 PCG 以外のサイズのファイルを指定すると誤動
     作する不具合いを修正。


ver. 1.02 : (1997/9)

  ● Ｃharlie版 GCC でンパイルした。若干高速になったかもしれない。


ver. 1.03 : (2021/1)

  ● ソースコードのサルベージに失敗。実行ファイルのみの状態に陥った。

  ● github に移動。

